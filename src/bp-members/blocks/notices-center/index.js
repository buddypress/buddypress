(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var n=e.n(t);const o=window.bp.noticesController;var i=e.n(o);class r{constructor(){this.container=document.querySelector("#bp-notices-container"),this.bubble=document.querySelector("#wp-admin-bar-bp-notifications")}catchEvents(e){if(e.target.dataset.bpDismissId){const t=document.querySelectorAll(".notice-item");if(1<t.length){e.preventDefault();let n=[];t.forEach((e=>{const t={id:parseInt(e.getAttribute("id").replace("notice-",""),10),prevLink:e.querySelector(".bp-notice-prev-page a"),nextLink:e.querySelector(".bp-notice-next-page a"),priorityPagination:e.querySelector(".priority-pagination"),totalCount:e.querySelector(".total-notices-count")};n.push(t)}));const o=parseInt(e.target.dataset.bpDismissId,10),r=document.querySelector("article#notice-"+o+" .bp-notice-request-status");r.classList.remove("error"),r.querySelector("p").innerHTML="",i()({action:"dismiss/"+o,method:"POST"}).then((t=>{if(!0===t.dismissed){e.target.closest("article#notice-"+o).remove();const t=this.bubble.querySelector(".count");t.innerHTML=parseInt(t.innerHTML,10)-1;const i=n.findIndex((({id:e})=>e===o));-1!==i&&(n.splice(i,1),n.forEach(((e,t)=>{0===t&&null!==e.prevLink?(e.prevLink.remove(),n[t].prevLink=null):e.prevLink&&(e.prevLink.setAttribute("href","#notice-"+n[t-1].id),n[t].prevLink=e.prevLink),n.length-1===t&&null!==e.nextLink?(e.nextLink.remove(),n[t].nextLink=null):e.nextLink&&(e.nextLink.setAttribute("href","#notice-"+n[t+1].id),n[t].nextLink=e.nextLink),e.priorityPagination.innerHTML=t+1+"/"+n.length,n[t].priorityPagination=e.priorityPagination,e.totalCount&&(e.totalCount.innerHTML=parseInt(e.totalCount.innerHTML,10)-1,n[t].totalCount=e.totalCount)})))}})).catch((e=>{r.querySelector("p").innerHTML=e,r.classList.add("error")}))}}}start(){this.container.addEventListener("click",this.catchEvents.bind(this),!1),void 0===this.container.popover?(this.container.remove(),console.warn("Your browser does not support the Popover API, please update it to its latest version to enjoy BuddyPress Notices."),document.querySelector("#bp-notices-toggler").addEventListener("click",(e=>{e.preventDefault();let t="";t="BUTTON"!==e.target.nodeName?e.target.closest("#bp-notices-toggler").dataset.bpFallbackUrl:e.target.dataset.bpFallbackUrl,location.href=t}))):(this.container.classList.remove("no-popover-support"),this.container.addEventListener("toggle",(e=>{"open"===e.newState?this.bubble.classList.contains("is-open")||this.bubble.classList.add("is-open"):this.bubble.classList.remove("is-open")})))}}n()((function(){(new r).start()}))})();